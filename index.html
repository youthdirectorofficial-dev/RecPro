<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Audio Recorder with localStorage</title>
  <style>
    :root {
      --bg-color: #1a1a1a;
      --primary-color: #2d2d2d;
      --secondary-color: #444;
      --text-color: #e0e0e0;
      --accent-color: #00aaff;
      --record-btn: #ff4b5c;
      --stop-btn: #1fab89;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: var(--primary-color);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    h2 {
      color: var(--accent-color);
    }
    button {
      background-color: var(--accent-color);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      margin: 5px;
      transition: background-color 0.3s, transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
    }
    #record { background-color: var(--record-btn); }
    #stop { background-color: var(--stop-btn); }
    button:disabled {
      background-color: var(--secondary-color);
      cursor: not-allowed;
      transform: none;
    }
    #recording-list {
      margin-top: 25px;
      text-align: left;
    }
    .recording-item {
      background: var(--secondary-color);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .recording-item audio {
      flex-grow: 1;
      margin: 0 15px;
      height: 40px;
    }
    .recording-item .delete-btn {
      background-color: var(--record-btn);
      padding: 8px 12px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>Audio Recorder ðŸŽ¤</h2>
    <p>Record audio and save it directly in your browser.</p>
    <div>
      <button id="record">Record</button>
      <button id="stop" disabled>Stop</button>
    </div>
    
    <div id="library">
      <h2>Library</h2>
      <div id="recording-list">
        <p>Your saved recordings will appear here.</p>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const recordButton = document.getElementById("record");
      const stopButton = document.getElementById("stop");
      const recordingList = document.getElementById("recording-list");

      let mediaRecorder;
      let audioChunks = [];

      // Load existing recordings on page load
      loadRecordings();

      // **Start Recording**
      recordButton.addEventListener("click", async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];

          mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
          };

          mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            convertBlobToBase64(audioBlob);
            stream.getTracks().forEach(track => track.stop()); // Release microphone
          };

          mediaRecorder.start();
          recordButton.disabled = true;
          stopButton.disabled = false;
        } catch (error) {
          console.error("Error accessing microphone:", error);
          alert("Could not access microphone. Please grant permission.");
        }
      });

      // **Stop Recording**
      stopButton.addEventListener("click", () => {
        mediaRecorder.stop();
        recordButton.disabled = false;
        stopButton.disabled = true;
      });

      // **Convert Blob to Base64 and Save**
      function convertBlobToBase64(blob) {
        const reader = new FileReader();
        reader.readAsDataURL(blob);
        reader.onloadend = () => {
          const base64String = reader.result;
          saveRecording(base64String);
        };
      }

      // **Save Recording to localStorage**
      function saveRecording(base64) {
        const recordings = JSON.parse(localStorage.getItem("recordings")) || [];
        const now = new Date();
        const title = `Recording - ${now.toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })}`;

        const newRecording = {
          title,
          base64
        };

        recordings.push(newRecording);
        localStorage.setItem("recordings", JSON.stringify(recordings));
        loadRecordings(); // Refresh the library view
      }

      // **Load and Display Recordings**
      function loadRecordings() {
        const recordings = JSON.parse(localStorage.getItem("recordings")) || [];
        recordingList.innerHTML = ""; // Clear list

        if (recordings.length === 0) {
          recordingList.innerHTML = "<p>No recordings found.</p>";
          return;
        }

        recordings.forEach((rec, index) => {
          const item = document.createElement("div");
          item.className = "recording-item";
          item.innerHTML = `
            <span>${rec.title}</span>
            <audio controls src="${rec.base64}"></audio>
            <button class="delete-btn" data-index="${index}">Delete</button>
          `;
          recordingList.appendChild(item);
        });
      }

      // **Delete Recording**
      recordingList.addEventListener("click", (event) => {
        if (event.target.classList.contains("delete-btn")) {
          const index = parseInt(event.target.getAttribute("data-index"), 10);
          deleteRecording(index);
        }
      });

      function deleteRecording(index) {
        const recordings = JSON.parse(localStorage.getItem("recordings")) || [];
        recordings.splice(index, 1); // Remove the item at the specified index
        localStorage.setItem("recordings", JSON.stringify(recordings));
        loadRecordings(); // Refresh the library
      }
    });
  </script>

</body>
</html>
